#!/bin/bash
# =========================================
# Quick Setup | Script Setup Manager
# Edition : Stable Edition V3.1
# Auther  : Geo Project
# (C) Copyright 2024
# =========================================

rm -rf /root/ub
if [ "${EUID}" -ne 0 ]; then
echo "You need to run this script as root"
exit 1
fi
if [ "$(systemd-detect-virt)" == "openvz" ]; then
echo "OpenVZ is not supported"
exit 1
fi
localip=$(hostname -I | cut -d\  -f1)
hst=( `hostname` )
dart=$(cat /etc/hosts | grep -w `hostname` | awk '{print $2}')
if [[ "$hst" != "$dart" ]]; then
echo "$localip $(hostname)" >> /etc/hosts
fi

cat > /root/.profile <<EOF
clear
sleep 2
screen -r
EOF
clear

clear
export BLUE='\033[0;34m'
export GREEN='\033[0;32m'
export CYAN='\033[0;36m'
export YELLOW='\033[0;33m'
export RED='\033[0;31m'
export NC='\033[0m'
export OK="[ ${GREEN}OK${NC} ]"
export ERROR="[ ${RED}ERROR${NC} ]"
export INFO="[ ${CYAN}INFO${NC} ]"
export FONT="${NC}"
rm -f /root/ub

function print_ok() {
echo -e "${OK} ${BLUE}$1${FONT}"
}
function print_install() {
if command -v lolcat &>/dev/null; then
echo -e "${YELLOW} ╔════════════════════════════════════════════╗ ${FONT}"
echo -e " ║ ( $1 ) " | lolcat
echo -e "${YELLOW} ╚════════════════════════════════════════════╝ ${FONT}"
else
echo -e "${YELLOW} ╔════════════════════════════════════════════╗ ${FONT}"
echo -e "${YELLOW} ║${NC} ( $1 ) ${YELLOW}║${FONT}"
echo -e "${YELLOW} ╚════════════════════════════════════════════╝ ${FONT}"
fi
sleep 1
}
function print_error() {
echo -e "${ERROR} ${RED}$1${FONT}"
}
function print_success() {
if [[ 0 -eq $? ]]; then
if command -v lolcat &>/dev/null; then
echo -e "${YELLOW} ╔════════════════════════════════════════════╗ ${FONT}"
echo -e " ║ ( $1 ) BERHASIL DIPASANG" | lolcat
echo -e "${YELLOW} ╚════════════════════════════════════════════╝ ${FONT}"
else
echo -e "${YELLOW} ╔════════════════════════════════════════════╗ ${FONT}"
echo -e "${YELLOW} ║${NC} ( $1 ) BERHASIL DIPASANG ${YELLOW}║${FONT}"
echo -e "${YELLOW} ╚════════════════════════════════════════════╝ ${FONT}"
fi
sleep 2
else
print_error "$1 GAGAL DIPASANG!"
sleep 2
fi
}
function install_lolcat() {
if ! command -v lolcat &>/dev/null; then
print_install "Menginstal Lolcat..."
sudo apt update -y >/dev/null 2>&1
sudo apt upgrade -y
sudo apt install -y lolcat
gem install lolcat
if [[ $? -ne 0 ]]; then
print_error "Gagal menginstal lolcat."
fi
fi
}
function display_banner() {
clear
echo -e "${BLUE}╔═════════════════════════════════════════════════════╗${NC}"
echo -e "${BLUE}║${GREEN}       ____ _____ _____      ______  _   _          ${BLUE} ║${NC}"
echo -e "${BLUE}║${GREEN}      / ___| ____/ _ \ \    / /  _ \| \ | |         ${BLUE} ║${NC}"
echo -e "${BLUE}║${GREEN}     | |  _|  _|| | | \ \  / /| |_) |  \| |         ${BLUE} ║${NC}"
echo -e "${BLUE}║${GREEN}     | |_| | |__| |_| |\ V /  |  __/| |\  |         ${BLUE} ║${NC}"
echo -e "${BLUE}║${GREEN}      \____|_____\___/  \_/   |_|   |_| \_|         ${BLUE} ║${NC}"
echo -e "${BLUE}║${NC}                                                     ${BLUE}║${NC}"
echo -e "${BLUE}║${NC}             ${YELLOW}MULTIPORT VPN SCRIPT V3.1${NC}              ${BLUE} ║${NC}"
echo -e "${BLUE}║${NC}                   ${CYAN}WWW.GEOVPN.COM${NC}                   ${BLUE} ║${NC}"
echo -e "${BLUE}║${NC}   TELEGRAM CH ${GREEN}@testikuy_mang${NC} ADMIN ${GREEN}@sampiiiiu${NC}      ${BLUE} ║${NC}"
echo -e "${BLUE}╚═════════════════════════════════════════════════════╝${NC}"
echo -e ""
}
function show_whiptail_progress() {
local phases=(
'    TELEGRAM : @sampiiiiu'
'    CHANNEL : @testikuy_mang'
'    WhatsApp : 082339191527'
)
if ! command -v whiptail &>/dev/null; then
print_error "Paket 'whiptail' tidak ditemukan. Progress bar tidak akan ditampilkan."
sleep 2
return
fi
for i in $(seq 1 100); do
sleep 0.05
if [ "$i" -eq 100 ]; then
echo -e "XXX\n100\n${GREEN}Selesai!${NC}\nXXX"
elif [ $((i % 25)) -eq 0 ]; then
local phase=$((i / 25 - 1))
echo -e "XXX\n$i\n${phases[$phase]}\nXXX"
else
echo "$i"
fi
done | whiptail --title "SCRIPT By GEO PROJECT" --gauge "Memuat modul instalasi..." 8 50 0
clear
}

function installer() {
display_banner
    clear
    echo -e " ${BLUE}        ┌────────────────────────────────────┐${NC}"
    echo -e " ${BLUE}        │${NC}${GREEN}\033[41m          INSTALLER Script          ${NC}${BLUE}│${NC}"
    echo -e " ${BLUE}        └────────────────────────────────────┘${NC}"
    echo -e "       ${BOLD_YELLOW}OS Anda ${GREEN}$(cat /etc/os-release | grep -w PRETTY_NAME | head -n1 | sed 's/=//g' | sed 's/"//g' | sed 's/PRETTY_NAME//g')${NC}"
    echo -e " ${BLUE}┌────────────────────────────────────┐${NC}"
    echo -e " ${BLUE}│${NC}[${GREEN}01${NC}] INSTALLER SCRIPT ( ${GREEN}Metode Lisensi Otomatis${NC}"
    echo -e " ${BLUE}│${NC}[${GREEN}02${NC}] INSTALLER SCRIPT ( ${GREEN}Metode Tambah IP${NC}"
    echo -e " ${BLUE}│${NC}${GREEN}Daftar Manual Admin ${NC}"
    echo -e " ${BLUE}└────────────────────────────────────┘${NC}"
    echo ""
    read -p "Pilih [ 1 - 2 ] : " menu

    case $menu in
        1 | 01)
            clear
            wget https://geoproject.biz.id/installer/sc && bash sc
            ;;
        2 | 02)
            clear
            sysctl -w net.ipv6.conf.all.disable_ipv6=1 && sysctl -w net.ipv6.conf.default.disable_ipv6=1
            apt update && apt upgrade -y
            apt install -y bzip2 gzip coreutils screen curl unzip
            apt install -y lolcat dropbear build-essential msmtp-mta ca-certificates bsd-mailx
            wget https://jaka2m.github.io/project/menu2/sc2.sh && chmod +x sc2.sh && screen -S sc2 ./sc2.sh
            ;;
        *)
            echo -e "${RED}[ERROR]${NC} Pilihan tidak valid. Silakan pilih 1 atau 2."
            exit 1
            ;;
    esac

    if command -v print_success &> /dev/null; then
        print_success "Pemasangan Script pada $(cat /etc/os-release | grep -w PRETTY_NAME | head -n1 | sed 's/=//g' | sed 's/"//g' | sed 's/PRETTY_NAME//g') selesai."
    else
        echo -e "${GREEN}Pemasangan Script pada $(cat /etc/os-release | grep -w PRETTY_NAME | head -n1 | sed 's/=//g' | sed 's/"//g' | sed 's/PRETTY_NAME//g') selesai.${NC}"
    fi
}
Installer
