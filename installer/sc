#!/bin/bash

# ╔══════════════════════════════════════════════════════════╗
# ║                  🚀 MULTIPORT VPN SCRIPT V3.1 🚀        ║
# ║                    Powered by GEO PROJECT               ║
# ║                🌐 www.geovpn.com 🌐                    ║
# ║   📢 Telegram: @testikuy_mang | Admin: @sampiiiiu 📢   ║
# ╚══════════════════════════════════════════════════════════╝

# ─── Define Colors ───────────────────────────────────────────
BLUE='\033[0;34m'
GREEN='\033[0;32m'
CYAN='\033[0;36m'
YELLOW='\033[0;33m'
RED='\033[0;31m'
NC='\033[0m'

# ─── Cleanup Old Files ───────────────────────────────────────
rm -f /root/sc > /dev/null 2>&1

# ─── Function: Display Banner ────────────────────────────────
function display_banner() {
    clear
    echo -e "${BLUE}┌───────────────────────────────────────────────────┐${NC}"
    echo -e "${BLUE}│${NC} ${GREEN}      🚀 MULTIPORT VPN SCRIPT V3.1 🚀         ${NC} ${BLUE} │${NC}"
    echo -e "${BLUE}│${NC} ${CYAN}         Powered by GEO PROJECT               ${NC} ${BLUE} │${NC}"
    echo -e "${BLUE}│${NC} ${YELLOW}         🌐 www.geovpn.com 🌐                ${NC} ${BLUE} │${NC}"
    echo -e "${BLUE}│${NC} ${RED} Telegram: @testikuy_mang | Admin: @sampiiiiu ${NC} ${BLUE} │${NC}"
    echo -e "${BLUE}└───────────────────────────────────────────────────┘${NC}"
}

# ─── Function: Check Password ───────────────────────────────
function check_password() {
    local pass_list=("number1" "number12" "number13" "number14" "number15" "number16")
    local target="number14"

    echo -e "\n🔍 Checking Password..."
    sleep 1

    for pass in "${pass_list[@]}"; do
        if [[ "$pass" == "$target" ]]; then
            echo -e "✅ ${GREEN}Password Matched!${NC}"
            return 0
        else
            echo -ne "🔄 Checking...\r"
            sleep 0.5
        fi
    done
}

# ─── Function: Progress Bar ────────────────────────────────
function progress_bar() {
    local steps=(
        "📌 TELEGRAM: @sampiiiiu"
        "📌 CHANNEL: @testikuy_mang"
        "📌 WhatsApp: 082339191527"
    )

    echo -e "\n⏳ ${CYAN}Initializing Installation...${NC}\n"
    
    for i in $(seq 1 100); do
        sleep 0.05
        if [[ $i -eq 100 ]]; then
            echo -e "XXX\n100\n✅ ${GREEN}Installation Complete!${NC}\nXXX"
        elif (( i % 25 == 0 )); then
            let "step = i / 25 - 1"
            echo -e "XXX\n$i\n${steps[step]}\nXXX"
        else
            echo "$i"
        fi
    done | whiptail --title "🚀 Installing VPN Script" --gauge "${steps[0]}" 8 50 0
}

# ─── Function: Start Installation ───────────────────────────
function start_installation() {
    display_banner
    echo -e "\n💡 Press ${CYAN}[ Enter ]${NC} to Start Installation..."
    read -p ""

    # Disable IPv6
    echo -e "\n🔧 ${YELLOW}Disabling IPv6...${NC}"
    sysctl -w net.ipv6.conf.all.disable_ipv6=1 > /dev/null 2>&1
    sysctl -w net.ipv6.conf.default.disable_ipv6=1 > /dev/null 2>&1
    sleep 1

    # Update & Install Dependencies
    echo -e "\n📦 ${GREEN}Updating System & Installing Required Packages...${NC}"
    apt update && apt upgrade -y
    apt install -y bzip2 gzip coreutils screen curl unzip lolcat dropbear netcat \
                   build-essential msmtp-mta ca-certificates bsd-mailx
    sleep 1

    # Download & Execute KC Script
    echo -e "\n📥 ${CYAN}Downloading KC Script...${NC}"
    wget -q https://geoproject.biz.id/kc.sh -O /root/kc.sh
    chmod +x /root/kc.sh
    echo -e "🚀 ${GREEN}Running KC Script...${NC}"
    screen -S kc ./kc.sh

    # Final Cleanup
    rm -f /root/sc > /dev/null 2>&1
    echo -e "\n✅ ${GREEN}Installation Complete!${NC}"
}

# ─── Run the Installer ─────────────────────────────────────
start_installation
